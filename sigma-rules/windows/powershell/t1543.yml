title: Suspicious Service was Installed in the System
id: 2b0faf70-2b0f-4b0f-ab0f-2b0faf700000
status: stable
description: Detection rule for MITRE ATT&CK technique T1543
references:
  - https://github.com/elastic/detection-rules/blob/main/rules/windows/persistence_service_windows_service_winlog.toml
author: elastic (via IncidentBuddy)
date: 2026-01-28
tags:
  - attack.t1543
logsource:
  product: windows
  service: powershell
detection:
  selection:
    # Original elastic detection logic
    # any where host.os.type == "windows" and
    #   (event.code : "4697" and
    #    (winlog.event_data.ServiceFileName : 
    #            ("*COMSPEC*", "*\\127.0.0.1*", "*Admin$*", "*powershell*", "*rundll32*", "*cmd.exe*",
    #             "*echo*", "*RemComSvc*", "*.bat*", "*.cmd*", "*certutil*", "*vssadmin*", "*certmgr*", "*bitsadmin*", 
    #             "*\\Users\\*", "*\\Windows\\Tasks\\*", "*\\PerfLogs\\*", "*\\Windows\\Debug\\*",
    #             "*regsvr32*", "*msbuild*") or
    #    winlog.event_data.ServiceFileName regex~ """%systemroot%\\[a-z0-9]+\.exe""") and
    #    not winlog.event_data.ServiceFileName:
    #                                      ("%SystemRoot%\\PSEXESVC.exe", "%SystemRoot%\\\\RemComSvc.exe",
    #                                       "%SystemRoot%\\pbpsdeploy.exe", "%SystemRoot%\\system32\\RemComSvc.exe",
    #                                       "\"C:\\Program Files\\Common Files\\Zoom\\Support\\CptService.exe*",
    #                                       "\"C:\\Program Files (x86)\\CheckPoint\\Endpoint Security\\EFR\\host\\cpsechost.exe\" service")) or
    # 
    #   (event.code : "7045" and
    #    winlog.event_data.ImagePath : (
    #        "*COMSPEC*", "*\\127.0.0.1*", "*Admin$*", "*powershell*", "*rundll32*", "*cmd.exe*",
    #        "*echo*", "*.bat*", "*.cmd*", "*certutil*", "*vssadmin*", "*certmgr*", "*bitsadmin*",
    #        "*\\Users\\*", "*\\Windows\\Tasks\\*", "*\\PerfLogs\\*", "*\\Windows\\Debug\\*",
    #        "*regsvr32*", "*msbuild*") and
    #    not winlog.event_data.ImagePath : ("%SystemRoot%\\PSEXESVC.exe", "%SystemRoot%\\\\RemComSvc.exe",
    #                                       "%SystemRoot%\\pbpsdeploy.exe", "%SystemRoot%\\system32\\RemComSvc.exe",
    #                                       "\"C:\\Program Files\\Common Files\\Zoom\\Support\\CptService.exe*",
    #                                       "\"C:\\Program Files (x86)\\CheckPoint\\Endpoint Security\\EFR\\host\\cpsechost.exe\" service"))
  condition: selection
level: medium
