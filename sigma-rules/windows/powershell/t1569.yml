title: Potential Privilege Escalation via Service ImagePath Modification
id: 3d045cbd-3d04-4d04-ad04-3d045cbd0000
status: stable
description: Detection rule for MITRE ATT&CK technique T1569
references:
  - https://github.com/elastic/detection-rules/blob/main/rules/windows/privilege_escalation_reg_service_imagepath_mod.toml
author: elastic (via IncidentBuddy)
date: 2026-02-01
tags:
  - attack.t1569
logsource:
  product: windows
  service: powershell
detection:
  selection:
    # Original elastic detection logic
    # registry where host.os.type == "windows" and event.type == "change" and process.executable != null and
    #   registry.data.strings != null and registry.value == "ImagePath" and
    #   registry.key : (
    #     "*\\ADWS", "*\\AppHostSvc", "*\\AppReadiness", "*\\AudioEndpointBuilder", "*\\AxInstSV", "*\\camsvc", "*\\CertSvc",
    #     "*\\COMSysApp", "*\\CscService", "*\\defragsvc", "*\\DeviceAssociationService", "*\\DeviceInstall", "*\\DevQueryBroker",
    #     "*\\Dfs", "*\\DFSR", "*\\diagnosticshub.standardcollector.service", "*\\DiagTrack", "*\\DmEnrollmentSvc", "*\\DNS",
    #     "*\\dot3svc", "*\\Eaphost", "*\\GraphicsPerfSvc", "*\\hidserv", "*\\HvHost", "*\\IISADMIN", "*\\IKEEXT",
    #     "*\\InstallService", "*\\iphlpsvc", "*\\IsmServ", "*\\LanmanServer", "*\\MSiSCSI", "*\\NcbService", "*\\Netlogon",
    #     "*\\Netman", "*\\NtFrs", "*\\PlugPlay", "*\\Power", "*\\PrintNotify", "*\\ProfSvc", "*\\PushToInstall", "*\\RSoPProv",
    #     "*\\sacsvr", "*\\SENS", "*\\SensorDataService", "*\\SgrmBroker", "*\\ShellHWDetection", "*\\shpamsvc", "*\\StorSvc",
    #     "*\\svsvc", "*\\swprv", "*\\SysMain", "*\\Themes", "*\\TieringEngineService", "*\\TokenBroker", "*\\TrkWks",
    #     "*\\UALSVC", "*\\UserManager", "*\\vm3dservice", "*\\vmicguestinterface", "*\\vmicheartbeat", "*\\vmickvpexchange",
    #     "*\\vmicrdv", "*\\vmicshutdown", "*\\vmicvmsession", "*\\vmicvss", "*\\vmvss", "*\\VSS", "*\\w3logsvc", "*\\W3SVC",
    #     "*\\WalletService", "*\\WAS", "*\\wercplsupport", "*\\WerSvc", "*\\Winmgmt", "*\\wisvc", "*\\wmiApSrv",
    #     "*\\WPDBusEnum", "*\\WSearch"
    #   ) and
    #   not (
    #     registry.data.strings : (
    #         "?:\\Windows\\system32\\*.exe",
    #         "%systemroot%\\system32\\*.exe",
    #         "%windir%\\system32\\*.exe",
    #         "%SystemRoot%\\system32\\svchost.exe -k *",
    #         "%windir%\\system32\\svchost.exe -k *"
    #     ) and
    #         not registry.data.strings : (
    #             "*\\cmd.exe",
    #             "*\\cscript.exe",
    #             "*\\ieexec.exe",
    #             "*\\iexpress.exe",
    #             "*\\installutil.exe",
    #             "*\
    # ... [truncated]
  condition: selection
level: medium
