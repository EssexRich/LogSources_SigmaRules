title: Persistence via PowerShell profile
id: 4632a6ac-4632-4632-a632-4632a6ac0000
status: stable
description: Detection rule for MITRE ATT&CK technique T1546
references:
  - https://github.com/elastic/detection-rules/blob/main/rules/windows/persistence_powershell_profiles.toml
author: elastic (via IncidentBuddy)
date: 2026-01-28
tags:
  - attack.t1546
logsource:
  product: windows
  service: powershell
detection:
  selection:
    # Original elastic detection logic
    # file where host.os.type == "windows" and event.type != "deletion" and
    #   file.name : ("profile.ps1", "Microsoft.Powershell_profile.ps1") and
    #   file.path : ("?:\\Users\\*\\Documents\\WindowsPowerShell\\*.ps1", 
    #                     "?:\\Users\\*\\Documents\\PowerShell\\*.ps1", 
    #                     "?:\\Windows\\System32\\WindowsPowerShell\\*.ps1", 
    #                     "\\Device\\HarddiskVolume*\\Users\\*\\Documents\\WindowsPowerShell\\*.ps1", 
    #                     "\\Device\\HarddiskVolume*\\Users\\*\\Documents\\PowerShell\\*.ps1", 
    #                     "\\Device\\HarddiskVolume*\\Windows\\System32\\WindowsPowerShell\\*.ps1")
  condition: selection
level: medium
