title: Delayed Execution via Ping
id: 04085df7-0408-4408-a408-04085df70000
status: stable
description: Detection rule for MITRE ATT&CK technique T1218.004
references:
  - https://github.com/elastic/detection-rules/blob/main/rules/windows/execution_delayed_via_ping_lolbas_unsigned.toml
author: elastic (via IncidentBuddy)
date: 2026-02-08
tags:
  - attack.t1218.004
logsource:
  product: windows
  service: powershell
detection:
  selection:
    # Original elastic detection logic
    # sequence by process.parent.entity_id with maxspan=1m
    #   [process where host.os.type == "windows" and event.action == "start" and process.name : "ping.exe" and
    #    process.args : "-n" and process.parent.name : "cmd.exe" and not user.id : "S-1-5-18"]
    #   [process where host.os.type == "windows" and event.action == "start" and
    #    process.parent.name : "cmd.exe" and
    #    (
    #         process.name : (
    #             "rundll32.exe", "powershell.exe",
    #             "mshta.exe", "msbuild.exe",
    #             "certutil.exe", "regsvr32.exe",
    #             "powershell.exe", "cscript.exe",
    #             "wscript.exe", "wmic.exe",
    #             "installutil.exe", "msxsl.exe",
    #             "Microsoft.Workflow.Compiler.exe",
    #             "ieexec.exe", "iexpress.exe",
    #             "RegAsm.exe", "installutil.exe",
    #             "RegSvcs.exe", "RegAsm.exe"
    #         ) or
    #         (process.executable : "?:\\Users\\*\\AppData\\*.exe" and not process.code_signature.trusted == true)
    #     ) and
    # 
    #     not process.args : ("?:\\Program Files\\*", "?:\\Program Files (x86)\\*") and
    #     not (process.name : ("openssl.exe", "httpcfg.exe", "certutil.exe") and process.parent.command_line : "*ScreenConnectConfigurator.cmd*") and
    #     not (process.pe.original_file_name : "DPInst.exe" and process.command_line : "driver\\DPInst_x64  /f ") and
    #     not (process.name : "powershell.exe" and process.args : "Write-Host ======*") and
    #     not (process.name : "wscript.exe" and process.args : "launchquiet_args.vbs" and process.parent.args : "?:\\Windows\\TempInst\\7z*") and
    #     not (process.name : "regsvr32.exe" and process.args : ("?:\\windows\\syswow64\\msxml?.dll", "msxml?.dll", "?:\\Windows\\SysWOW64\\mschrt20.ocx")) and
    #     not (process.name : "wscript.exe" and
    #          process.working_directory :
    #                     ("?:\\Windows\\TempInst\\*",
    #                      "?:\\Users\\*\\AppData\\Local\\Temp\\BackupBootstrapper\\Logs\\",
    #                      "?:\\Users\\*\\AppData\\Local\\Temp\\QBTools\\"))
    #     ]
  condition: selection
level: medium
