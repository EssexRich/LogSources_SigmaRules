title: Potential Remote File Execution via MSIEXEC
id: 1c76927d-1c76-4c76-ac76-1c76927d0000
status: stable
description: Detection rule for MITRE ATT&CK technique T1566.002
references:
  - https://github.com/elastic/detection-rules/blob/main/rules/windows/initial_access_execution_remote_via_msiexec.toml
author: elastic (via IncidentBuddy)
date: 2026-02-01
tags:
  - attack.t1566.002
logsource:
  product: windows
  service: powershell
detection:
  selection:
    # Original elastic detection logic
    # sequence with maxspan=1m
    #  [process where host.os.type == "windows" and event.action == "start" and
    #     process.name : "msiexec.exe" and process.args : "/V"] by process.entity_id
    #  [network where host.os.type == "windows" and process.name : "msiexec.exe" and
    #     event.action == "connection_attempted"] by process.entity_id
    #  [process where host.os.type == "windows" and event.action == "start" and
    #   process.parent.name : "msiexec.exe" and user.id : ("S-1-5-21-*", "S-1-5-12-1-*") and
    #   not process.executable : ("?:\\Windows\\SysWOW64\\msiexec.exe",
    #                             "?:\\Windows\\System32\\msiexec.exe",
    #                             "?:\\Windows\\System32\\srtasks.exe",
    #                             "?:\\Windows\\SysWOW64\\srtasks.exe",
    #                             "?:\\Windows\\System32\\taskkill.exe",
    #                             "?:\\Windows\\Installer\\MSI*.tmp",
    #                             "?:\\Program Files\\*.exe",
    #                             "?:\\Program Files (x86)\\*.exe",
    #                             "?:\\Windows\\System32\\ie4uinit.exe",
    #                             "?:\\Windows\\SysWOW64\\ie4uinit.exe",
    #                             "?:\\Windows\\System32\\sc.exe",
    #                             "?:\\Windows\\system32\\Wbem\\mofcomp.exe",
    #                             "?:\\Windows\\twain_32\\fjscan32\\SOP\\crtdmprc.exe",
    #                             "?:\\Windows\\SysWOW64\\taskkill.exe",
    #                             "?:\\Windows\\SysWOW64\\schtasks.exe",
    #                             "?:\\Windows\\system32\\schtasks.exe",
    #                             "?:\\Windows\\System32\\sdbinst.exe") and
    #   not (process.code_signature.subject_name == "Citrix Systems, Inc." and process.code_signature.trusted == true) and
    #   not (process.name : ("regsvr32.exe", "powershell.exe", "rundll32.exe", "wscript.exe") and
    #        process.Ext.token.integrity_level_name == "high" and
    #        process.args : ("?:\\Program Files\\*", "?:\\Program Files (x86)\\*")) and
    #   not (process.executable : ("?:\
    # ... [truncated]
  condition: selection
level: medium
