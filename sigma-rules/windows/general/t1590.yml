title: Suspicious DNS Query for IP Lookup Service APIs
id: 797f33e6-797f-497f-a97f-797f33e60000
status: stable
description: Detection rule for MITRE ATT&CK technique T1590
references:
  - https://github.com/SigmaHQ/sigma/blob/master/rules/windows/dns_query/dns_query_win_susp_external_ip_lookup.yml
author: sigma (via IncidentBuddy)
date: 2026-02-08
tags:
  - attack.t1590
logsource:
  product: windows
  service: general
detection:
  selection:
    # Original sigma detection logic
    #     selection:
    #         - QueryName:
    #               - 'www.ip.cn'
    #               - 'l2.io'
    #         - QueryName|contains:
    #               - 'api.2ip.ua'
    #               - 'api.bigdatacloud.net'
    #               - 'api.ipify.org'
    #               - 'bot.whatismyipaddress.com'
    #               - 'canireachthe.net'
    #               - 'checkip.amazonaws.com'
    #               - 'checkip.dyndns.org'
    #               - 'curlmyip.com'
    #               - 'db-ip.com'
    #               - 'edns.ip-api.com'
    #               - 'eth0.me'
    #               - 'freegeoip.app'
    #               - 'geoipy.com'
    #               - 'getip.pro'
    #               - 'icanhazip.com'
    #               - 'ident.me'
    #               - 'ifconfig.io'
    #               - 'ifconfig.me'
    #               - 'ip-api.com'
    #               - 'ip.360.cn'
    #               - 'ip.anysrc.net'
    #               - 'ip.taobao.com'
    #               - 'ip.tyk.nu'
    #               - 'ipaddressworld.com'
    #               - 'ipapi.co'
    #               - 'ipconfig.io'
    #               - 'ipecho.net'
    #               - 'ipinfo.io'
    #               - 'ipip.net'
    #               - 'ipof.in'
    #               - 'ipv4.icanhazip.com'
    #               - 'ipv4bot.whatismyipaddress.com'
    #               - 'ipv6-test.com'
    #               - 'ipwho.is'
    #               - 'jsonip.com'
    #               - 'myexternalip.com'
    #               - 'seeip.org'
    #               - 'wgetip.com'
    #               - 'whatismyip.akamai.com'
    #               - 'whois.pconline.com.cn'
    #               - 'wtfismyip.com'
    #     filter_optional_brave:
    #         Image|endswith: '\brave.exe'
    #     filter_optional_chrome:
    #         Image:
    #             - 'C:\Program Files\Google\Chrome\Application\chrome.exe'
    #             - 'C:\Program Files (x86)\Google\Chrome\Application\chrome.exe'
    #     filter_optional_firefox:
    #         Image:
    #             - 'C:\Program Files\Mozilla Firefox\firefox.exe'
    #             - 'C:\Program Files (x86)\Mozilla Firefox\firefox.exe'
    #     filter_optional_ie:
    #         Image:
    #             - 'C:\Program Files (x86)\Internet Explorer\iexplore.exe'
    #             - 'C:\Program Files\Int
    # ... [truncated]
  condition: selection
level: medium
