title: NTDS.DIT Creation By Uncommon Parent Process
id: 1f750de7-1f75-4f75-af75-1f750de70000
status: stable
description: Detection rule for MITRE ATT&CK technique T1003.003
references:
  - https://github.com/SigmaHQ/sigma/blob/master/rules/windows/file/file_event/file_event_win_ntds_dit_uncommon_parent_process.yml
author: sigma (via IncidentBuddy)
date: 2026-01-28
tags:
  - attack.t1003.003
logsource:
  product: windows
  service: sysmon
detection:
  selection:
    # Original sigma detection logic
    #     selection_file:
    #         TargetFilename|endswith: '\ntds.dit'
    #     selection_process_parent:
    #         # Note: ParentImage is a custom field and is not available by default on Sysmon EID 11
    #         ParentImage|endswith:
    #             - '\cscript.exe'
    #             - '\httpd.exe'
    #             - '\nginx.exe'
    #             - '\php-cgi.exe'
    #             - '\powershell.exe'
    #             - '\pwsh.exe'
    #             - '\w3wp.exe'
    #             - '\wscript.exe'
    #     selection_process_parent_path:
    #         # Note: ParentImage is a custom field and is not available by default on Sysmon EID 11
    #         ParentImage|contains:
    #             - '\apache'
    #             - '\tomcat'
    #             - '\AppData\'
    #             - '\Temp\'
    #             - '\Public\'
    #             - '\PerfLogs\'
    #     condition: selection_file and 1 of selection_process_*
    # 
  condition: selection
level: medium
