title: Enumerating Domain Trusts via NLTEST.EXE
id: 71ae064d-71ae-41ae-a1ae-71ae064d0000
status: stable
description: Detection rule for MITRE ATT&CK technique T1018
references:
  - https://github.com/elastic/detection-rules/blob/main/rules/windows/discovery_enumerating_domain_trusts_via_nltest.toml
author: elastic (via IncidentBuddy)
date: 2026-01-28
tags:
  - attack.t1018
logsource:
  product: windows
  service: sysmon
detection:
  selection:
    # Original elastic detection logic
    # process where host.os.type == "windows" and event.type == "start" and
    #     process.name : "nltest.exe" and process.args : (
    #         "/DCLIST:*", "/DCNAME:*", "/DSGET*",
    #         "/LSAQUERYFTI:*", "/PARENTDOMAIN",
    #         "/DOMAIN_TRUSTS", "/BDC_QUERY:*"
    #         ) and 
    # not process.parent.name : "PDQInventoryScanner.exe" and
    # not (
    #   user.id in ("S-1-5-18", "S-1-5-19", "S-1-5-20") and
    #   /* Don't apply the user.id exclusion to Sysmon for compatibility */
    #   not event.dataset : ("windows.sysmon_operational", "windows.sysmon")
    # )
  condition: selection
level: medium
