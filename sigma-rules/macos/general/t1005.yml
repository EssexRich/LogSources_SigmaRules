title: Suspicious TCC Access Granted for User Folders
id: 2bfa9e24-2bfa-4bfa-abfa-2bfa9e240000
status: stable
description: Detection rule for MITRE ATT&CK technique T1005
references:
  - https://github.com/elastic/detection-rules/blob/main/rules/macos/defense_evasion_suspicious_tcc_access_granted.toml
author: elastic (via IncidentBuddy)
date: 2026-02-08
tags:
  - attack.t1005
logsource:
  product: macos
  service: general
detection:
  selection:
    # Original elastic detection logic
    # FROM logs-endpoint.events.*
    # | WHERE host.os.type == "macos" 
    #     AND event.action == "tcc_modify" 
    #     AND Tcc.right == "allowed"
    #     AND Tcc.update_type == "create"
    #     AND Tcc.service IN ("SystemPolicyDocumentsFolder", "SystemPolicyDownloadsFolder", "SystemPolicyDesktopFolder")
    #     AND Effective_process.name RLIKE "(bash|zsh|sh|osascript|python.*|perl.*|ruby.*|node|Terminal|iTerm2|ghostty)"
    # | STATS 
    #     Esql.grant_count = COUNT(*),
    #     Esql.unique_folders = COUNT_DISTINCT(Tcc.service),  
    #     Esql.folders = VALUES(Tcc.service)
    #   BY Effective_process.entity_id, Effective_process.executable, host.name, user.name
    # | WHERE Esql.unique_folders >= 2
    # | KEEP Esql.*, Effective_process.entity_id, Effective_process.executable, host.name, user.name
  condition: selection
level: medium
