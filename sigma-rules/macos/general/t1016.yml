title: DNS Request for IP Lookup Service via Unsigned Binary
id: 5ef784aa-5ef7-4ef7-aef7-5ef784aa0000
status: stable
description: Detection rule for MITRE ATT&CK technique T1016
references:
  - https://github.com/elastic/detection-rules/blob/main/rules/macos/discovery_dns_request_for_ip_lookup_service.toml
author: elastic (via IncidentBuddy)
date: 2026-02-08
tags:
  - attack.t1016
logsource:
  product: macos
  service: general
detection:
  selection:
    # Original elastic detection logic
    # dns where host.os.type == "macos" and event.action == "lookup_result" and 
    #   (process.code_signature.trusted == false or process.code_signature.exists == false) and
    #   dns.question.name like~ ("*ip-api.com*", "*ipwho.is*", "*checkip.dyndns.org*", "*api.ipify.org*",
    #                            "*api.npoint.io*", "*whatismyip.akamai.com*", "*bot.whatismyipaddress.com*",
    #                            "*ifcfg.me*", "*ifconfig.me*", "*ident.me*", "*ipof.in*", "*ip.tyk.nu*",
    #                            "*ipwhois.app*", "*freeipapi.com*", "*icanhazip.com*", "*curlmyip.com*",
    #                            "*wgetip.com*", "*eth0.me*", "*ipecho.net*", "*ip.appspot.com*",
    #                            "*api.myip.com*", "*geoiptool.com*", "*api.2ip.ua*", "*api.ip.sb*",
    #                            "*ipinfo.io*", "*checkip.amazonaws.com*", "*wtfismyip.com*", "*iplogger.*",
    #                            "*freegeoip.net*", "*freegeoip.app*", "*myip.ipip.net*", "*geoplugin.net*",
    #                            "*myip.dnsomatic.com*", "*www.geoplugin.net*", "*api64.ipify.org*",
    #                            "*ip4.seeip.org*", "*.geojs.io*", "*portmap.io*", "*api.db-ip.com*",
    #                            "*geolocation-db.com*", "*inet-ip.info*", "*httpbin.org*", "*myip.opendns.com*") and
    #   not process.executable like "/Users/*/Library/Developer/CoreSimulator/*"
  condition: selection
level: medium
